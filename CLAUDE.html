<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Claude Code Guidelines for quallmer • quallmer</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Claude Code Guidelines for quallmer"><meta property="og:image" content="https://seraphinem.github.io/quallmer/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">quallmer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials"><li><a class="dropdown-item" href="articles/getting-started.html">Quick start guide</a></li>
    <li><a class="dropdown-item" href="articles/pkgdown/tutorials/openai.html">Signing up for an openai API key</a></li>
    <li><a class="dropdown-item" href="articles/pkgdown/tutorials/ollama.html">Working with an open-source Ollama model</a></li>
    <li><a class="dropdown-item" href="articles/pkgdown/tutorials/predefined.html">Using predefined tasks</a></li>
    <li><a class="dropdown-item" href="articles/pkgdown/tutorials/customtask.html">Defining custom tasks</a></li>
    <li><a class="dropdown-item" href="articles/pkgdown/tutorials/validate.html">Using the Agreement App</a></li>
    <li><a class="dropdown-item" href="articles/pkgdown/tutorials/trail.html">The quallmer trail</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-predefined-tasks" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Predefined tasks</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-predefined-tasks"><li><a class="dropdown-item" href="articles/pkgdown/examples/overview.html">Overview of predefined tasks</a></li>
    <li><a class="dropdown-item" href="articles/pkgdown/examples/task_sentiment.html">Sentiment analysis</a></li>
    <li><a class="dropdown-item" href="articles/pkgdown/examples/task_stance.html">Stance detection / position taking</a></li>
    <li><a class="dropdown-item" href="articles/pkgdown/examples/task_ideology.html">Ideological scaling</a></li>
    <li><a class="dropdown-item" href="articles/pkgdown/examples/task_salience.html">Salience of topics</a></li>
    <li><a class="dropdown-item" href="articles/pkgdown/examples/task_fact.html">Fact-checking</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SeraphineM/quallmer" aria-label="View on GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Claude Code Guidelines for quallmer</h1>

    </div>

<div id="claude-code-guidelines-for-quallmer" class="section level1">

<div class="section level2">
<h2 id="project-overview">Project Overview<a class="anchor" aria-label="anchor" href="#project-overview"></a></h2>
<p>quallmer is an R package for qualitative data annotation and validation. It provides: - <code><a href="reference/annotate.html">annotate()</a></code>: Core function for LLM-powered text annotation - <code><a href="reference/validate_app.html">validate_app()</a></code>: Shiny application for validating annotations against gold standards - Integration with the ellmer framework for LLM interactions</p>
</div>
<div class="section level2">
<h2 id="key-development-commands">Key Development Commands<a class="anchor" aria-label="anchor" href="#key-development-commands"></a></h2>
<p><strong>General Advice:</strong> - Run R with <code>R --quiet --vanilla</code> for clean, reproducible sessions - Always run <code>devtools::document()</code> after modifying roxygen2 comments - All new code requires accompanying tests</p>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>
<ul><li>Test files follow pattern: <code>tests/testthat/test-{name}.R</code> maps to <code>R/{name}.R</code>
</li>
<li>Run all tests: <code>devtools::test(reporter = "check")</code>
</li>
<li>Run specific tests: <code>devtools::test(filter = "name", reporter = "check")</code>
</li>
<li>
<strong>Avoid</strong> <code>devtools::test_active_file()</code> - prefer full test suite</li>
<li>Place new tests near similar existing tests</li>
<li>Check coverage: <code><a href="http://covr.r-lib.org/reference/package_coverage.html" class="external-link">covr::package_coverage()</a></code>
</li>
</ul></div>
<div class="section level3">
<h3 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h3>
<ul><li>Run <code>devtools::document()</code> after modifying roxygen2 comments</li>
<li>Every user-facing function needs <code>@export</code> and complete roxygen2 documentation</li>
<li>Add new documentation topics to <code>_pkgdown.yml</code>
</li>
<li>Verify with <code><a href="https://pkgdown.r-lib.org/reference/check_pkgdown.html" class="external-link">pkgdown::check_pkgdown()</a></code>
</li>
<li>Use sentence case for headings in documentation</li>
<li>Update NEWS.md with user-facing changes following tidyverse style</li>
</ul></div>
<div class="section level3">
<h3 id="building-and-checking">Building and Checking<a class="anchor" aria-label="anchor" href="#building-and-checking"></a></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Build tarball</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">R</span> CMD build .</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Check as CRAN</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="ex">R</span> CMD check quallmer_<span class="pp">*</span>.tar.gz <span class="at">--as-cran</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="website">Website<a class="anchor" aria-label="anchor" href="#website"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">build_site</a></span><span class="op">(</span><span class="op">)</span>     <span class="co"># Build/update website in docs/</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/check_pkgdown.html" class="external-link">check_pkgdown</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Validate pkgdown configuration</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-the-shiny-app">Running the Shiny App<a class="anchor" aria-label="anchor" href="#running-the-shiny-app"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">quallmer</span><span class="fu">::</span><span class="fu"><a href="reference/validate_app.html">validate_app</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Launch validation interface</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="project-structure--modules">Project Structure &amp; Modules<a class="anchor" aria-label="anchor" href="#project-structure--modules"></a></h2>
<ul><li>
<strong>R/</strong>: Package source code (e.g., <code>annotate.R</code>, <code>validate_app.R</code>, <code>task_*.R</code>)</li>
<li>
<strong>tests/testthat/</strong>: Unit tests using testthat edition 3</li>
<li>
<strong>tests/testthat.R</strong>: Test runner</li>
<li>
<strong>man/</strong>: Auto-generated documentation via roxygen2 (do not edit manually)</li>
<li>
<strong>vignettes/</strong>: Package vignettes and long-form documentation</li>
<li>
<strong>data/</strong>: Example datasets (e.g., <code>baker</code>, <code>druguse</code>)</li>
<li>
<strong>data_creation/</strong>: Scripts for generating package datasets</li>
<li>**_pkgdown.yml, docs/**: pkgdown website configuration and built site</li>
<li>
<strong>DESCRIPTION</strong>: Package metadata and dependencies</li>
<li>
<strong>NAMESPACE</strong>: Auto-generated by roxygen2</li>
<li>
<strong>.github/workflows/</strong>: GitHub Actions for CI/CD</li>
</ul></div>
<div class="section level2">
<h2 id="coding-conventions">Coding Conventions<a class="anchor" aria-label="anchor" href="#coding-conventions"></a></h2>
<div class="section level3">
<h3 id="code-style">Code Style<a class="anchor" aria-label="anchor" href="#code-style"></a></h3>
<ul><li>
<strong>Indentation</strong>: 2 spaces (no tabs)</li>
<li>
<strong>Line length</strong>: Keep reasonable; avoid overly long lines</li>
<li>
<strong>Naming</strong>: snake_case for all functions, arguments, and objects
<ul><li>Examples: <code><a href="reference/trail_settings.html">trail_settings()</a></code>, <code><a href="reference/task_sentiment.html">task_sentiment()</a></code>, <code>gold_standard</code>
</li>
</ul></li>
<li>
<strong>Organization</strong>: Newspaper-style - high-level functions first, helpers below</li>
<li>
<strong>Nested functions</strong>: Avoid nested function definitions (except trivial lambdas)</li>
<li>
<strong>Imports</strong>: Use namespace-qualified calls: <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code>, <code><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli::cli_abort()</a></code>
</li>
</ul></div>
<div class="section level3">
<h3 id="error-messages">Error Messages<a class="anchor" aria-label="anchor" href="#error-messages"></a></h3>
<ul><li>Use <code><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli::cli_abort()</a></code> for all user-facing errors (never <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code>)</li>
<li>Follow tidyverse error style guidelines:
<ul><li>Clear, actionable messages that tell users what went wrong and how to fix it</li>
<li>Use <code>{variable}</code> interpolation for values</li>
<li>Bullet points (<code>*</code>, <code>i</code>, <code>x</code>) for structured messages</li>
</ul></li>
<li>See <code>R/annotate.R</code> for input validation examples</li>
</ul></div>
<div class="section level3">
<h3 id="documentation-1">Documentation<a class="anchor" aria-label="anchor" href="#documentation-1"></a></h3>
<ul><li>Use roxygen2 for all exported functions</li>
<li>Include complete <code>@param</code> and <code>@return</code> documentation</li>
<li>Add <code>@export</code> for user-facing APIs</li>
<li>Add <code>@examples</code> where appropriate (use <code>\dontrun{}</code> for examples requiring API keys)</li>
<li>Document all user-facing functions, even internal helpers that users might see</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="ellmer-integration">ellmer Integration<a class="anchor" aria-label="anchor" href="#ellmer-integration"></a></h2>
<p>quallmer builds on the ellmer framework. Key points: - Use ellmer’s <code>chat()</code> and <code>turn()</code> for LLM interactions - Follow ellmer conventions for model configuration and API usage - Maintain compatibility with ellmer’s streaming and async features</p>
</div>
<div class="section level2">
<h2 id="testing-guidelines">Testing Guidelines<a class="anchor" aria-label="anchor" href="#testing-guidelines"></a></h2>
<div class="section level3">
<h3 id="framework-and-workflow">Framework and Workflow<a class="anchor" aria-label="anchor" href="#framework-and-workflow"></a></h3>
<ul><li>testthat edition 3</li>
<li>File naming: <code>tests/testthat/test-{name}.R</code> maps to <code>R/{name}.R</code>
</li>
<li><strong>All new code requires accompanying tests</strong></li>
<li>Place new tests near similar existing tests</li>
</ul></div>
<div class="section level3">
<h3 id="running-tests">Running Tests<a class="anchor" aria-label="anchor" href="#running-tests"></a></h3>
<ul><li>Run all tests: <code>devtools::test(reporter = "check")</code>
</li>
<li>Run specific tests: <code>devtools::test(filter = "name", reporter = "check")</code>
</li>
<li>
<strong>Avoid</strong> <code>devtools::test_active_file()</code> - always run full test suite</li>
<li>Check coverage: <code><a href="http://covr.r-lib.org/reference/package_coverage.html" class="external-link">covr::package_coverage()</a></code>
</li>
</ul></div>
<div class="section level3">
<h3 id="testing-principles">Testing Principles<a class="anchor" aria-label="anchor" href="#testing-principles"></a></h3>
<ul><li>Write focused, atomic tests for each function</li>
<li>Mock external services (LLM APIs) - no network calls in unit tests</li>
<li>Use test fixtures from <code>tests/testthat/fixtures/</code> when needed</li>
<li>Test edge cases, error conditions, and typical usage patterns</li>
<li>Tests should be fast and deterministic</li>
</ul></div>
<div class="section level3">
<h3 id="cicd">CI/CD<a class="anchor" aria-label="anchor" href="#cicd"></a></h3>
<ul><li>GitHub Actions run R CMD check on multiple platforms (Linux, macOS, Windows)</li>
<li>Code coverage tracked and reported via Codecov</li>
<li>pkgdown site built and deployed automatically on push to main</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="git-workflow">Git Workflow<a class="anchor" aria-label="anchor" href="#git-workflow"></a></h2>
<div class="section level3">
<h3 id="commits">Commits<a class="anchor" aria-label="anchor" href="#commits"></a></h3>
<ul><li><p>Use imperative mood: “Add feature” not “Added feature”</p></li>
<li><p>Keep subject line concise (50 chars or less)</p></li>
<li><p>Reference issues when applicable: “Fixes #21”, “Closes #45”</p></li>
<li>
<p>Include Claude Code attribution when appropriate:</p>
<pre><code>Add trail comparison summary

Generated with Claude Code

Co-Authored-By: Claude Sonnet 4.5 &lt;noreply@anthropic.com&gt;</code></pre>
</li>
</ul></div>
<div class="section level3">
<h3 id="pull-requests">Pull Requests<a class="anchor" aria-label="anchor" href="#pull-requests"></a></h3>
<p>Use <code>.github/pull_request_template.md</code> to structure PRs. Include: - <strong>Clear summary</strong>: What does this PR do? - <strong>Motivation</strong>: Why is this change needed? - <strong>Scope</strong>: What files/functions are affected? - <strong>Tests</strong>: Add tests for new behavior - <strong>Documentation</strong>: Update man pages, vignettes, or README as needed - <strong>NEWS</strong>: Add bullet to NEWS.md for user-facing changes - <strong>Screenshots</strong>: For UI changes to <code><a href="reference/validate_app.html">validate_app()</a></code>, include before/after screenshots</p>
</div>
<div class="section level3">
<h3 id="newsmd-entries">NEWS.md Entries<a class="anchor" aria-label="anchor" href="#newsmd-entries"></a></h3>
<p>Follow tidyverse style: - One bullet per user-facing change - Use code font for functions: <code>`annotate()`</code> - Reference issues/PRs and contributors: <code>(#123, @username)</code> - Examples: - <code>`annotate()` now supports custom system prompts (#45).</code> - <code>Fixed error in `validate_app()` when gold column is missing (#67).</code> - <code>Documentation: Added "Custom tasks" vignette (#78).</code></p>
</div>
</div>
<div class="section level2">
<h2 id="file-locations">File Locations<a class="anchor" aria-label="anchor" href="#file-locations"></a></h2>
<div class="section level3">
<h3 id="important-files-to-know">Important Files to Know<a class="anchor" aria-label="anchor" href="#important-files-to-know"></a></h3>
<ul><li>
<code>R/annotate.R</code>: Main annotation function</li>
<li>
<code>R/validate_app.R</code>: Shiny validation app</li>
<li>
<code>R/task_*.R</code>: Task definition functions (sentiment, summary, etc.)</li>
<li>
<code>R/utils.R</code>: Utility functions</li>
<li>
<code>tests/testthat/test-annotate.R</code>: Tests for annotation</li>
<li>
<code>tests/testthat/test-validate_app.R</code>: Tests for Shiny app</li>
<li>
<code>vignettes/quallmer.Rmd</code>: Main package vignette</li>
</ul></div>
<div class="section level3">
<h3 id="configuration-files">Configuration Files<a class="anchor" aria-label="anchor" href="#configuration-files"></a></h3>
<ul><li>
<code>.Rbuildignore</code>: Files/patterns to exclude from R CMD build</li>
<li>
<code>_pkgdown.yml</code>: Website structure and appearance</li>
<li>
<code>.github/workflows/</code>: CI configuration</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="security--best-practices">Security &amp; Best Practices<a class="anchor" aria-label="anchor" href="#security--best-practices"></a></h2>
<div class="section level3">
<h3 id="api-keys">API Keys<a class="anchor" aria-label="anchor" href="#api-keys"></a></h3>
<ul><li>Never commit API keys or tokens</li>
<li>Use environment variables: <code>OPENAI_API_KEY</code>, <code>ANTHROPIC_API_KEY</code>
</li>
<li>Document API key setup in vignettes/README</li>
<li>CI uses repository secrets for automated builds</li>
</ul></div>
<div class="section level3">
<h3 id="reproducibility">Reproducibility<a class="anchor" aria-label="anchor" href="#reproducibility"></a></h3>
<ul><li>Use <code>R --quiet --vanilla</code> for clean R sessions</li>
<li>Include <code><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo()</a></code> when reporting issues</li>
<li>Pin package versions when needed for reproducibility</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="common-tasks">Common Tasks<a class="anchor" aria-label="anchor" href="#common-tasks"></a></h2>
<div class="section level3">
<h3 id="adding-a-new-task-type">Adding a New Task Type<a class="anchor" aria-label="anchor" href="#adding-a-new-task-type"></a></h3>
<ol style="list-style-type: decimal"><li>Create <code>R/task_newtype.R</code> with roxygen docs</li>
<li>Add <code>tests/testthat/test-task_newtype.R</code>
</li>
<li>Document in appropriate vignette</li>
<li>Update <code>_pkgdown.yml</code> reference section</li>
<li>Add NEWS.md entry</li>
<li>Run <code>devtools::document()</code> and <code>devtools::check()</code>
</li>
</ol></div>
<div class="section level3">
<h3 id="updating-the-shiny-app">Updating the Shiny App<a class="anchor" aria-label="anchor" href="#updating-the-shiny-app"></a></h3>
<ol style="list-style-type: decimal"><li>Modify <code>R/validate_app.R</code>
</li>
<li>Test interactively with <code><a href="reference/validate_app.html">quallmer::validate_app()</a></code>
</li>
<li>Add tests in <code>tests/testthat/test-validate_app.R</code>
</li>
<li>Take before/after screenshots for PR</li>
<li>Document UI changes in NEWS.md</li>
</ol></div>
<div class="section level3">
<h3 id="fixing-a-bug">Fixing a Bug<a class="anchor" aria-label="anchor" href="#fixing-a-bug"></a></h3>
<ol style="list-style-type: decimal"><li>Write a failing test that reproduces the bug</li>
<li>Fix the bug in the source code</li>
<li>Verify test now passes</li>
<li>Add NEWS.md entry with issue reference</li>
<li>Create PR linking to the issue</li>
</ol></div>
</div>
<div class="section level2">
<h2 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a></h2>
<ul><li>
<a href="https://r-pkgs.org/" class="external-link">R Packages (2e)</a>: Comprehensive guide to R package development</li>
<li>
<a href="https://style.tidyverse.org/" class="external-link">tidyverse style guide</a>: Coding style conventions</li>
<li>
<a href="https://testthat.r-lib.org/" class="external-link">testthat documentation</a>: Testing framework</li>
<li>
<a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown documentation</a>: Website generation</li>
<li>
<a href="https://ellmer.tidyverse.org/" class="external-link">ellmer documentation</a>: LLM integration framework</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Seraphine F. Maerz, Kenneth Benoit.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

