---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# quallmer <a href="https://SeraphineM.github.io/quallmer/"><img src="man/figures/logo.png" align="right" height="138" alt="quallmer website" /></a>

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/quallmer)](https://CRAN.R-project.org/package=quallmer)
[![R-CMD-check](https://github.com/SeraphineM/quallmer/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/SeraphineM/quallmer/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/SeraphineM/quallmer/graph/badge.svg)](https://app.codecov.io/gh/SeraphineM/quallmer)
[![pkgdown](https://img.shields.io/badge/pkgdown-site-blue)](https://SeraphineM.github.io/quallmer/)
<!-- badges: end -->

The **quallmer** package is an **easy-to-use toolbox for qualitative researchers to quickly apply AI-assisted coding to texts, images, pdfs, tabular data and other structured data.**

Using `qlm_code()`, users can apply codebook-based coding powered by large language models (LLMs) to generate structured, interpretable outputs. The package includes built-in codebooks for common applications and allows researchers to create custom codebooks tailored to their specific research questions using `qlm_codebook()`. To ensure quality and reliability of AI-generated coding, **quallmer** provides `qlm_validate()` for assessing accuracy against gold standards and `qlm_compare()` for evaluating inter-rater reliability. With `qlm_replicate()`, researchers can systematically compare results across different models and settings to assess sensitivity and reproducibility. The package also includes `validate_app()`, an interactive app for manual coding, reviewing AI-generated output, and computing agreement metrics.

**The quallmer package makes AI-assisted qualitative coding accessible without requiring deep expertise in R, programming or machine learning.**

## Core functions

### Coding and validation workflow

#### `qlm_codebook()`
- Creates custom codebooks tailored to specific research questions and data types.
- Uses `system_prompt` and type specifications from [ellmer](https://ellmer.tidyverse.org/reference/type_boolean.html) to define coding instructions and output structure.
- Built-in codebooks (e.g., `data_codebook_sentiment`) provide ready-to-use examples for common applications.
- Extensible framework allows researchers to define domain-specific coding schemes.

#### `qlm_code()`
- Applies LLM-based coding to qualitative data using a codebook specification.
- Works with any LLM supported by [ellmer](https://ellmer.tidyverse.org/index.html).
- Returns a `qlm_coded` object containing the coded results and metadata for reproducibility.

#### `qlm_compare()`
- Compares multiple `qlm_coded` objects to assess inter-rater reliability.
- Computes agreement metrics including Krippendorff's alpha, Cohen's kappa, and Fleiss' kappa.
- Useful for evaluating consistency across different coders, models, or coding runs.

#### `qlm_validate()`
- Validates LLM-coded output against gold standard human coding.
- Computes classification metrics: accuracy, precision, recall, F1-score, and Cohen's kappa.
- Supports multiple averaging methods (macro, micro, weighted) and per-class breakdowns.

## Replication

### `qlm_replicate()`
- Re-executes coding with optional overrides (different models, codebooks, or parameters).
- Tracks provenance chain for comparing results across different configurations.
- Enables systematic assessment of coding reliability and sensitivity to model choices.


### The quallmer trail

Apart from the core functions above, the **quallmer** package also provides a set of functions to ensure reproducibility and reliability of LLM-generated annotations through **systematic comparisons across multiple LLM runs with different settings.** This "trail" functionality adds a reproducibility layer on top of `annotate()` with the following workflow:

![](man/figures/paw.png){width=40%}

1. **Define trail settings**
   Describe the LLM trail, i.e., how LLMs should be called (e.g., model, temperature).

   `trail_settings()`
   ↓

2. **Record single LLM trails for reproducibility**
   Record all information needed for reproducing LLM runs on a given task with a specific setting.

   `trail_record(data, text_col, task, setting, id_col)`

   ↓

3. **Run multiple trails with different settings and assess sensitivity**
   Run the *same* task and data across multiple settings (e.g., different LLMs, different temperatures) and compute agreement across trails to illustrate reliability and replication sensitivity of LLM annotations.

   `trail_compare(data, text_col, task, settings = list(...), id_col, lablel_col)`


## Interactive validation

The `validate_app()` function launches an interactive Shiny application for:  
- **Manual coding**: Code qualitative data directly in the interface  
- **Review AI-generated coding**: Examine LLM-produced codes alongside original data   
- **Compute agreement metrics**: Evaluate inter-rater reliability or validate against gold standards  


## Supported LLMs

The package supports all LLMs currently available with the `ellmer`
package. For authentication and usage of each of these LLMs, please refer to the
respective [ellmer](https://ellmer.tidyverse.org/reference/index.html) documentation and see our [tutorial for setting up an OpenAI API key](https://seraphinem.github.io/quallmer/articles/pkgdown/tutorials/openai.html) or [getting started with an open-source Ollama model](https://seraphinem.github.io/quallmer/articles/pkgdown/tutorials/ollama.html).

## Installation

You can install the development version of **quallmer** from
<https://github.com/SeraphineM/quallmer> with:

```{r, eval = FALSE}
# install.packages("pak")
pak::pak("SeraphineM/quallmer")
```

## Example use and tutorials

To learn more about how to use the package, please refer to our [step-by-step tutorials](https://seraphinem.github.io/quallmer/articles/getting-started.html) and 
the illustrations on [how to use the predefined tasks](https://seraphinem.github.io/quallmer/articles/pkgdown/examples/overview.html).
