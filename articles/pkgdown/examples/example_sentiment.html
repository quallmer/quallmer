<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example: Sentiment analysis • quallmer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../../../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../../../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../../../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../../../favicon.ico">
<link rel="manifest" href="../../../site.webmanifest">
<script src="../../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../../deps/search-1.0.0/fuse.min.js"></script><script src="../../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../../pkgdown.js"></script><meta property="og:title" content="Example: Sentiment analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../../index.html">quallmer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-getting-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Getting started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-getting-started">
<li><a class="dropdown-item" href="../../../articles/getting-started.html">Quick start guide</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/openai.html">Signing up for an OpenAI API key</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/ollama.html">Working with an open-source Ollama model</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/custom-codebook.html">Creating codebooks</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/compare.html">Comparing and replicating coded results</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/trace.html">The quallmer audit trail</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/validate.html">Using the quallmer.app</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SeraphineM/quallmer" aria-label="View on GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../../logo.png" class="logo" alt=""><h1>Example: Sentiment analysis</h1>
            
      

      <div class="d-none name"><code>example_sentiment.Rmd</code></div>
    </div>

    
    
<p>This example demonstrates sentiment analysis of movie reviews using
<code><a href="../../../reference/qlm_code.html">qlm_code()</a></code> with the predefined
<code>data_codebook_sentiment</code> codebook. We’ll analyze reviews
from the Large Movie Review Dataset (Maas et al. 2011) and validate the
results against movie ratings and polarity assigned by the people who
left these reviews, from the original dataset.</p>
<div class="section level2">
<h2 id="loading-packages-and-data">Loading packages and data<a class="anchor" aria-label="anchor" href="#loading-packages-and-data"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">quanteda.tidy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: quanteda</span></span></code></pre>
<pre><code><span><span class="co">## Package version: 4.3.1</span></span>
<span><span class="co">## Unicode version: 15.1</span></span>
<span><span class="co">## ICU version: 74.2</span></span></code></pre>
<pre><code><span><span class="co">## Parallel computing: disabled</span></span></code></pre>
<pre><code><span><span class="co">## See https://quanteda.io for tutorials and examples.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'quanteda.tidy'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:quanteda.tidy':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     add_tally</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://seraphinem.github.io/quallmer/">quallmer</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: ellmer</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># inspect the labelled data</span></span>
<span><span class="fu"><a href="https://quanteda.io/reference/convert.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">data_corpus_LMRDsample</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">polarity</span>, <span class="va">rating</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">polarity</span>, values_from <span class="op">=</span> <span class="va">n</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/adorn_totals.html" class="external-link">adorn_totals</a></span><span class="op">(</span><span class="st">"row"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  rating neg pos</span></span>
<span><span class="co">##       1  43   0</span></span>
<span><span class="co">##       2  18   0</span></span>
<span><span class="co">##       3  20   0</span></span>
<span><span class="co">##       4  19   0</span></span>
<span><span class="co">##       7   0  22</span></span>
<span><span class="co">##       8   0  20</span></span>
<span><span class="co">##       9   0  22</span></span>
<span><span class="co">##      10   0  36</span></span>
<span><span class="co">##   Total 100 100</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="inspecting-the-codebook">Inspecting the codebook<a class="anchor" aria-label="anchor" href="#inspecting-the-codebook"></a>
</h2>
<p>The <code>data_codebook_sentiment</code> codebook provides structured
sentiment analysis. Let’s examine its components:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the codebook name and role</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Codebook name:"</span>, <span class="va">data_codebook_sentiment</span><span class="op">$</span><span class="va">name</span>, <span class="st">"\n\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Codebook name: Sentiment analysis</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Role:"</span>, <span class="va">data_codebook_sentiment</span><span class="op">$</span><span class="va">role</span>, <span class="st">"\n\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Role: You are a political communication analyst evaluating public statements.</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the instructions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Instructions:\n"</span>, <span class="va">data_codebook_sentiment</span><span class="op">$</span><span class="va">instructions</span>, <span class="st">"\n\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Instructions:</span></span>
<span><span class="co">##  Analyze the sentiment of this text, on both a 1-10 scale and as a polarity of negative or positive.</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the schema structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Schema:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Schema:</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">data_codebook_sentiment</span><span class="op">$</span><span class="va">schema</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;ellmer::TypeObject&gt;</span></span>
<span><span class="co">##  @ description          : NULL</span></span>
<span><span class="co">##  @ required             : logi TRUE</span></span>
<span><span class="co">##  @ properties           :List of 2</span></span>
<span><span class="co">##  .. $ sentiment: &lt;ellmer::TypeEnum&gt;</span></span>
<span><span class="co">##  ..  ..@ description: chr "Overall sentiment polarity: negative (neg) or positive (pos)"</span></span>
<span><span class="co">##  ..  ..@ required   : logi TRUE</span></span>
<span><span class="co">##  ..  ..@ values     : chr [1:2] "neg" "pos"</span></span>
<span><span class="co">##  .. $ rating   : &lt;ellmer::TypeBasic&gt;</span></span>
<span><span class="co">##  ..  ..@ description: chr "Sentiment rating from 1 (most negative) to 10 (most positive)"</span></span>
<span><span class="co">##  ..  ..@ required   : logi TRUE</span></span>
<span><span class="co">##  ..  ..@ type       : chr "integer"</span></span>
<span><span class="co">##  @ additional_properties: logi FALSE</span></span></code></pre>
<p>The codebook produces two outputs: - <code>polarity</code>:
Categorical sentiment (negative or positive) - <code>rating</code>:
Numeric sentiment rating from 1 (most negative) to 10 (most
positive)</p>
</div>
<div class="section level2">
<h2 id="coding-movie-reviews-using-gemini-2-5-flash">Coding movie reviews using Gemini 2.5 Flash<a class="anchor" aria-label="anchor" href="#coding-movie-reviews-using-gemini-2-5-flash"></a>
</h2>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply sentiment analysis using qlm_code()</span></span>
<span><span class="va">coded_g2.5_flash</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/qlm_code.html">qlm_code</a></span><span class="op">(</span></span>
<span>  <span class="va">data_corpus_LMRDsample</span>,</span>
<span>  codebook <span class="op">=</span> <span class="va">data_codebook_sentiment</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"google_gemini/gemini-2.5-flash"</span>,</span>
<span>  max_active <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  include_cost <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/params.html" class="external-link">params</a></span><span class="op">(</span>temperature <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Total cost:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total cost: $"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">coded_g2.5_flash</span><span class="op">$</span><span class="va">cost</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Total cost: $0.2478</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="validating-against-gold-standard">Validating against gold standard<a class="anchor" aria-label="anchor" href="#validating-against-gold-standard"></a>
</h2>
<p>The corpus includes human-coded sentiment labels in its docvars. We
can use <code><a href="../../../reference/qlm_validate.html">qlm_validate()</a></code> to assess the LLM’s performance:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract gold standard labels from corpus docvars</span></span>
<span><span class="co"># The docvars include both 'polarity' (neg/pos) and 'rating' (1-10)</span></span>
<span><span class="va">gold_standard</span> <span class="op">&lt;-</span> <span class="va">data_corpus_LMRDsample</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="fu"><a href="https://quanteda.io/reference/docnames.html" class="external-link">docnames</a></span><span class="op">(</span><span class="va">data_corpus_LMRDsample</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://quanteda.io/reference/docvars.html" class="external-link">docvars</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Validate polarity predictions (nominal data)</span></span>
<span><span class="va">polarity_validation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/qlm_validate.html">qlm_validate</a></span><span class="op">(</span></span>
<span>  <span class="va">coded_g2.5_flash</span>,</span>
<span>  gold <span class="op">=</span> <span class="va">gold_standard</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"polarity"</span>,</span>
<span>  level <span class="op">=</span> <span class="st">"nominal"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Converting `gold` to <span style="color: #0000BB;">&lt;qlm_humancoded&gt;</span> object.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `qlm_humancoded()` directly to provide coder names and metadata.</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">polarity_validation</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # quallmer validation</span></span>
<span><span class="co">## # n: 200 | classes: 2 | average: macro</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## accuracy:      0.9500</span></span>
<span><span class="co">## precision:     0.9500</span></span>
<span><span class="co">## recall:        0.9500</span></span>
<span><span class="co">## f1:            0.9500</span></span>
<span><span class="co">## Cohen's kappa: 0.9000</span></span>
<span><span class="co">## Pearson's r:   0.9500</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Validate rating predictions (ordinal data)</span></span>
<span><span class="va">rating_validation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/qlm_validate.html">qlm_validate</a></span><span class="op">(</span></span>
<span>  <span class="va">coded_g2.5_flash</span>,</span>
<span>  gold <span class="op">=</span> <span class="va">gold_standard</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"rating"</span>,</span>
<span>  level <span class="op">=</span> <span class="st">"ordinal"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Converting `gold` to <span style="color: #0000BB;">&lt;qlm_humancoded&gt;</span> object.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `qlm_humancoded()` directly to provide coder names and metadata.</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rating_validation</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # quallmer validation</span></span>
<span><span class="co">## # n: 200 | levels: 10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Spearman's rho:0.5570</span></span>
<span><span class="co">## Kendall's tau: 0.4851</span></span>
<span><span class="co">## Pearson's r:   0.5570</span></span>
<span><span class="co">## MAE:           1.8000</span></span></code></pre>
<p>If we were to treat the <code>rating</code> variable as interval,
then we get these validation metrics:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/qlm_validate.html">qlm_validate</a></span><span class="op">(</span></span>
<span>  <span class="va">coded_g2.5_flash</span>,</span>
<span>  gold <span class="op">=</span> <span class="va">gold_standard</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"rating"</span>,</span>
<span>  level <span class="op">=</span> <span class="st">"interval"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Converting `gold` to <span style="color: #0000BB;">&lt;qlm_humancoded&gt;</span> object.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `qlm_humancoded()` directly to provide coder names and metadata.</span></span></code></pre>
<pre><code><span><span class="co">## # quallmer validation</span></span>
<span><span class="co">## # n: 200</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Pearson's r:   0.9368</span></span>
<span><span class="co">## ICC:           0.9350</span></span>
<span><span class="co">## MAE:           0.7600</span></span>
<span><span class="co">## RMSE:          1.2845</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="comparing-to-a-second-llm-coding-from-gpt-5-1">Comparing to a second LLM coding from GPT-5.1<a class="anchor" aria-label="anchor" href="#comparing-to-a-second-llm-coding-from-gpt-5-1"></a>
</h2>
<div class="section level3">
<h3 id="compared-to-the-previous-llm-scoring">Compared to the previous LLM scoring<a class="anchor" aria-label="anchor" href="#compared-to-the-previous-llm-scoring"></a>
</h3>
<p>We can use <code><a href="../../../reference/qlm_compare.html">qlm_compare()</a></code> to try a more advanced model,
to see how this changes things, comparing its performance to the
previous model, and also to the gold standard.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply sentiment analysis using qlm_code()</span></span>
<span><span class="va">coded_gpt5.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/qlm_code.html">qlm_code</a></span><span class="op">(</span></span>
<span>  <span class="va">data_corpus_LMRDsample</span>,</span>
<span>  codebook <span class="op">=</span> <span class="va">data_codebook_sentiment</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"openai/gpt-5.1"</span>,</span>
<span>  max_active <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  include_cost <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/params.html" class="external-link">params</a></span><span class="op">(</span>temperature <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we can compare the agreement between the two LLM codings, for
polarity:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/qlm_compare.html">qlm_compare</a></span><span class="op">(</span><span class="va">coded_g2.5_flash</span>, <span class="va">coded_gpt5.1</span>, by <span class="op">=</span> <span class="st">"polarity"</span>, level <span class="op">=</span> <span class="st">"nominal"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # Inter-rater reliability</span></span>
<span><span class="co">## # Subjects: 200 </span></span>
<span><span class="co">## # Raters:   2 </span></span>
<span><span class="co">## # Level:    nominal </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Krippendorff's alpha: 0.9501</span></span>
<span><span class="co">## Cohen's kappa:        0.9500</span></span>
<span><span class="co">## Percent agreement:    0.9750</span></span></code></pre>
<p>For the numerical (1-10) variable for rating, we can specify the
level as ordinal:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/qlm_compare.html">qlm_compare</a></span><span class="op">(</span><span class="va">coded_g2.5_flash</span>, <span class="va">coded_gpt5.1</span>, by <span class="op">=</span> <span class="st">"rating"</span>, level <span class="op">=</span> <span class="st">"ordinal"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # Inter-rater reliability</span></span>
<span><span class="co">## # Subjects: 200 </span></span>
<span><span class="co">## # Raters:   2 </span></span>
<span><span class="co">## # Level:    ordinal </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Krippendorff's alpha: 0.9443</span></span>
<span><span class="co">## Weighted kappa:       0.7525</span></span>
<span><span class="co">## Kendall's W:          0.9538</span></span>
<span><span class="co">## Spearman's rho:       0.9609</span></span>
<span><span class="co">## Percent agreement:    0.5900</span></span></code></pre>
<p>If we change the tolerance for agreement, we see that agreement
changes but that no other measures do:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/qlm_compare.html">qlm_compare</a></span><span class="op">(</span><span class="va">coded_g2.5_flash</span>, <span class="va">coded_gpt5.1</span>, by <span class="op">=</span> <span class="st">"rating"</span>, level <span class="op">=</span> <span class="st">"ordinal"</span>,</span>
<span>            tolerance <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # Inter-rater reliability</span></span>
<span><span class="co">## # Subjects: 200 </span></span>
<span><span class="co">## # Raters:   2 </span></span>
<span><span class="co">## # Level:    ordinal </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Krippendorff's alpha: 0.9443</span></span>
<span><span class="co">## Weighted kappa:       0.7525</span></span>
<span><span class="co">## Kendall's W:          0.9538</span></span>
<span><span class="co">## Spearman's rho:       0.9609</span></span>
<span><span class="co">## Percent agreement:    0.9700</span></span></code></pre>
<p>If we treat the 1-10 ratings as interval, then we see:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/qlm_compare.html">qlm_compare</a></span><span class="op">(</span><span class="va">coded_g2.5_flash</span>, <span class="va">coded_gpt5.1</span>, by <span class="op">=</span> <span class="st">"rating"</span>, level <span class="op">=</span> <span class="st">"interval"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # Inter-rater reliability</span></span>
<span><span class="co">## # Subjects: 200 </span></span>
<span><span class="co">## # Raters:   2 </span></span>
<span><span class="co">## # Level:    interval </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Krippendorff's alpha: 0.9743</span></span>
<span><span class="co">## ICC:                  0.9744</span></span>
<span><span class="co">## Pearson's r:          0.9793</span></span>
<span><span class="co">## Percent agreement:    0.5900</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="gpt-5-1-versus-the-gold-standard">GPT-5.1 versus the “gold standard”<a class="anchor" aria-label="anchor" href="#gpt-5-1-versus-the-gold-standard"></a>
</h3>
<p>Finally, we can compare the new LLM scoring to the gold standard, for
polarity:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/qlm_validate.html">qlm_validate</a></span><span class="op">(</span></span>
<span>  <span class="va">coded_gpt5.1</span>,</span>
<span>  gold <span class="op">=</span> <span class="va">gold_standard</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"polarity"</span>,</span>
<span>  level <span class="op">=</span> <span class="st">"nominal"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Converting `gold` to <span style="color: #0000BB;">&lt;qlm_humancoded&gt;</span> object.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `qlm_humancoded()` directly to provide coder names and metadata.</span></span></code></pre>
<pre><code><span><span class="co">## # quallmer validation</span></span>
<span><span class="co">## # n: 200 | classes: 2 | average: macro</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## accuracy:      0.9550</span></span>
<span><span class="co">## precision:     0.9561</span></span>
<span><span class="co">## recall:        0.9550</span></span>
<span><span class="co">## f1:            0.9550</span></span>
<span><span class="co">## Cohen's kappa: 0.9100</span></span>
<span><span class="co">## Pearson's r:   0.9550</span></span></code></pre>
<p>Compare this to the previous values from Gemini 2.5 Flash:</p>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Converting `gold` to <span style="color: #0000BB;">&lt;qlm_humancoded&gt;</span> object.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `qlm_humancoded()` directly to provide coder names and metadata.</span></span></code></pre>
<pre><code><span><span class="co">## # quallmer validation</span></span>
<span><span class="co">## # n: 200 | classes: 2 | average: macro</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## accuracy:      0.9500</span></span>
<span><span class="co">## precision:     0.9500</span></span>
<span><span class="co">## recall:        0.9500</span></span>
<span><span class="co">## f1:            0.9500</span></span>
<span><span class="co">## Cohen's kappa: 0.9000</span></span>
<span><span class="co">## Pearson's r:   0.9500</span></span></code></pre>
<p>That’s only a tiny improvement.</p>
<p>For the interval rating:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../../reference/qlm_validate.html">qlm_validate</a></span><span class="op">(</span></span>
<span>  <span class="va">coded_gpt5.1</span>,</span>
<span>  gold <span class="op">=</span> <span class="va">gold_standard</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"rating"</span>,</span>
<span>  level <span class="op">=</span> <span class="st">"interval"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Converting `gold` to <span style="color: #0000BB;">&lt;qlm_humancoded&gt;</span> object.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `qlm_humancoded()` directly to provide coder names and metadata.</span></span></code></pre>
<pre><code><span><span class="co">## # quallmer validation</span></span>
<span><span class="co">## # n: 200</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Pearson's r:   0.9355</span></span>
<span><span class="co">## ICC:           0.9346</span></span>
<span><span class="co">## MAE:           0.7600</span></span>
<span><span class="co">## RMSE:          1.2329</span></span></code></pre>
<p>Compared to Gemini 2.5 Flash:</p>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Converting `gold` to <span style="color: #0000BB;">&lt;qlm_humancoded&gt;</span> object.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `qlm_humancoded()` directly to provide coder names and metadata.</span></span></code></pre>
<pre><code><span><span class="co">## # quallmer validation</span></span>
<span><span class="co">## # n: 200</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Pearson's r:   0.9368</span></span>
<span><span class="co">## ICC:           0.9350</span></span>
<span><span class="co">## MAE:           0.7600</span></span>
<span><span class="co">## RMSE:          1.2845</span></span></code></pre>
<p>Call it a draw!</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Seraphine F. Maerz, Kenneth Benoit.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
