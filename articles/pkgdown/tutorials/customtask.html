<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Defining custom tasks • quallmer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../../../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../../../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../../../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../../../favicon.ico">
<link rel="manifest" href="../../../site.webmanifest">
<script src="../../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../../deps/search-1.0.0/fuse.min.js"></script><script src="../../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../../pkgdown.js"></script><meta property="og:title" content="Defining custom tasks">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../../index.html">quallmer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../../../articles/getting-started.html">Quick start guide</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/openai.html">Signing up for an openai API key</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/ollama.html">Working with an open-source Ollama model</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/predefined.html">Using predefined tasks</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/customtask.html">Defining custom tasks</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/validate.html">Using the Agreement App</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/tutorials/trail.html">The quallmer trail</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-predefined-tasks" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Predefined tasks</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-predefined-tasks">
<li><a class="dropdown-item" href="../../../articles/pkgdown/examples/overview.html">Overview of predefined tasks</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/examples/task_sentiment.html">Sentiment analysis</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/examples/task_stance.html">Stance detection / position taking</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/examples/task_ideology.html">Ideological scaling</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/examples/task_salience.html">Salience of topics</a></li>
    <li><a class="dropdown-item" href="../../../articles/pkgdown/examples/task_fact.html">Fact-checking</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SeraphineM/quallmer" aria-label="View on GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="customtask_files/kePrint-0.0.1/kePrint.js"></script><link href="customtask_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../../logo.png" class="logo" alt=""><h1>Defining custom tasks</h1>
            
      

      <div class="d-none name"><code>customtask.Rmd</code></div>
    </div>

    
    
<p>In this tutorial, we will explore how to create custom annotation
tasks using the <code>quallmer</code> package. Custom tasks allow you to
tailor the LLM’s output to your specific research questions and data
types using the <code><a href="../../../reference/task.html">task()</a></code> function, providing greater
flexibility and control over the annotation process.</p>
<p>In the following example, we will demonstrate how to define a custom
task for scoring documents based on their alignment with political left
ideologies. For this, we formulate a prompt that asks the LLM to score
documents on a scale of political left alignment. We then define the
expected response structure using the <code><a href="../../../reference/task.html">task()</a></code> function.
Finally, we will use the <code><a href="../../../reference/annotate.html">annotate()</a></code> function to apply this
custom task to a sample corpus of inaugural speeches from US
presidents.</p>
<div class="section level3">
<h3 id="loading-packages-and-data">Loading packages and data<a class="anchor" aria-label="anchor" href="#loading-packages-and-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We will use the quanteda package </span></span>
<span><span class="co"># for loading a sample corpus of innaugural speeches</span></span>
<span><span class="co"># If you have not yet installed the quanteda package, you can do so by:</span></span>
<span><span class="co"># install.packages("quanteda")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://quanteda.io" class="external-link">quanteda</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Package version: 4.3.1</span></span>
<span><span class="co">## Unicode version: 15.1</span></span>
<span><span class="co">## ICU version: 74.2</span></span></code></pre>
<pre><code><span><span class="co">## Parallel computing: disabled</span></span></code></pre>
<pre><code><span><span class="co">## See https://quanteda.io for tutorials and examples.</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://seraphinem.github.io/quallmer/">quallmer</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: ellmer</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For educational purposes, </span></span>
<span><span class="co"># we will use a subset of the inaugural speeches corpus</span></span>
<span><span class="co"># The three most recent speeches in the corpus</span></span>
<span><span class="va">data_corpus_inaugural</span> <span class="op">&lt;-</span> <span class="fu">quanteda</span><span class="fu">::</span><span class="va"><a href="https://quanteda.io/reference/data_corpus_inaugural.html" class="external-link">data_corpus_inaugural</a></span><span class="op">[</span><span class="fl">57</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="defining-a-custom-prompt">Defining a custom prompt<a class="anchor" aria-label="anchor" href="#defining-a-custom-prompt"></a>
</h3>
<p>Defining prompts is a crucial step in creating custom tasks. The
prompt guides the LLM on how to interpret the input data and what kind
of output to generate. In this example, we will create a prompt that
instructs the LLM to score documents based on their alignment with
political left ideologies. Prompts can be much longer and more complex
depending on the task at hand. Prompts should be clear and specific to
ensure that the LLM understands the task requirements.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prompt</span> <span class="op">&lt;-</span> <span class="st">"Score the following document on a scale of how much it aligns</span></span>
<span><span class="st">with the political left. The political left is defined as groups which</span></span>
<span><span class="st">advocate for social equality, government intervention in the economy,</span></span>
<span><span class="st">and progressive policies. Use the following metrics:</span></span>
<span><span class="st">SCORING METRIC:</span></span>
<span><span class="st">3 : extremely left</span></span>
<span><span class="st">2 : very left</span></span>
<span><span class="st">1 : slightly left</span></span>
<span><span class="st">0 : not at all left"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="defining-the-structure-of-the-response-with-define_task">Defining the structure of the response with define_task()<a class="anchor" aria-label="anchor" href="#defining-the-structure-of-the-response-with-define_task"></a>
</h3>
<p>The <code><a href="../../../reference/task.html">task()</a></code> function allows us to specify the expected
structure of the LLM’s response. It has the following important
arguments which users need to specify:</p>
<ul>
<li>
<code>name</code>: A descriptive name for the task.</li>
<li>
<code>system_prompt</code>: The prompt that guides the LLM on how to
perform the task.</li>
<li>
<code>type_def</code>: Defines the expected structure of the
response using <a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">ellmers
type specifications</a> such as <code><a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">type_object()</a></code>,
<code><a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">type_array()</a></code>, etc.</li>
</ul>
<p>For more information on how to use ellmer’s type specifications,
please refer to the <a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">ellmer
documentation on type specifications</a>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the custom task using task()</span></span>
<span><span class="va">ideology_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/task.html">task</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Score Political Left Alignment"</span>,</span>
<span>  system_prompt <span class="op">=</span> <span class="va">prompt</span>,</span>
<span>  type_def <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">type_object</a></span><span class="op">(</span></span>
<span>    score <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">type_number</a></span><span class="op">(</span><span class="st">"Score"</span><span class="op">)</span>,</span>
<span>    explanation <span class="op">=</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">type_string</a></span><span class="op">(</span><span class="st">"Explanation"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  input_type <span class="op">=</span> <span class="st">"text"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="applying-the-custom-task-to-the-corpus">Applying the custom task to the corpus<a class="anchor" aria-label="anchor" href="#applying-the-custom-task-to-the-corpus"></a>
</h3>
<p>This step is similar to applying predefined tasks using the
<code><a href="../../../reference/annotate.html">annotate()</a></code> function. Here, we will use the
<code><a href="../../../reference/annotate.html">annotate()</a></code> function to apply our custom task to the sample
corpus of inaugural speeches. We will specify the model to use via
<code>model_name</code> (in this case, <code>"openai/gpt-4o"</code>) and
any additional parameters as needed. For example, we set the temperature
to 0 via the <code>params</code> argument for more deterministic
outputs, improving consistency in scoring across multiple runs and
therefore increasing reliability.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply the custom task to the inaugural speeches corpus</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../../reference/annotate.html">annotate</a></span><span class="op">(</span><span class="va">data_corpus_inaugural</span>, task <span class="op">=</span> <span class="va">ideology_scores</span>,</span>
<span>                   model_name <span class="op">=</span> <span class="st">"openai/gpt-4o"</span>,</span>
<span>                   params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temperature <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [working] (0 + 0) -&gt; 3 -&gt; 1 | <span style="color: #00BB00;">■■■■■■■■■                       </span>  25%</span></span></code></pre>
<pre><code><span><span class="co">## [working] (0 + 0) -&gt; 0 -&gt; 4 | <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■ </span> 100%</span></span></code></pre>
<table class="table table table-striped table-hover" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
id
</th>
<th style="text-align:right;">
score
</th>
<th style="text-align:left;">
explanation
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
2013-Obama
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
The document aligns very well with the political left, emphasizing
social equality, government intervention, and progressive policies. It
advocates for collective action, economic equality, climate change
response, and social justice, all of which are key tenets of leftist
ideology. However, it also acknowledges skepticism of central authority
and the importance of personal responsibility, which slightly moderates
its alignment.
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-Trump
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
The document emphasizes nationalism, protectionism, and a focus on
American interests, which are not typically aligned with the political
left. It lacks advocacy for social equality, government intervention in
the economy, or progressive policies, which are key aspects of leftist
ideology. Therefore, it scores 0 for alignment with the political left.
</td>
</tr>
<tr>
<td style="text-align:left;">
2021-Biden
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
The document aligns very well with the political left, emphasizing
themes of social equality, racial justice, and government intervention
in addressing economic challenges. It calls for unity, healing, and
addressing systemic racism and climate change, which are typically
progressive priorities. However, it also emphasizes unity and
bipartisanship, which slightly moderates its alignment with the extreme
left.
</td>
</tr>
<tr>
<td style="text-align:left;">
2025-Trump
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
The document emphasizes nationalism, border security, military strength,
and economic independence, which are typically associated with
right-wing ideologies. It criticizes government intervention and
progressive policies like the Green New Deal, and promotes traditional
values and a merit-based society. These elements do not align with the
political left’s focus on social equality, government intervention in
the economy, and progressive policies.
</td>
</tr>
</tbody>
</table>
<p>Now you have successfully created and applied a custom annotation
task using the <code>quallmer</code> package! You can further modify the
prompt and response structure to suit your specific research needs.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Seraphine F. Maerz, Kenneth Benoit.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
